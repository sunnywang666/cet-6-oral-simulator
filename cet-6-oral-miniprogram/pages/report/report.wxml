<!--pages/report/report.wxml-->
<view class="container">
  <view class="header-card">
    <view class="header-content">
      <text class="report-title">{{isViewingHistory ? '历史报告' : '考试报告'}}</text>
      <text class="grade-label">总体评分</text>
      <text class="grade-value">{{examResult.totalGrade}}</text>
    </view>
    <view class="errors-box">
      <text class="errors-title">高频错误</text>
      <view class="errors-list">
        <text class="error-item" wx:for="{{examResult.highFreqErrors}}" wx:key="index">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- Sections -->
  <view class="sections">
    <view class="section-card" wx:for="{{sections}}" wx:key="index">
      <view class="section-header">
        <text class="section-title">{{item.title}}</text>
        <text class="section-score">Score: {{item.data.score}}/15</text>
      </view>
      
      <!-- Original Text -->
      <view class="original-text-box" wx:if="{{item.data.originalText}}">
        <text class="original-text-label">Your Answer:</text>
        <text class="original-text">{{item.data.originalText}}</text>
      </view>

      <!-- Feedback with Dimensions -->
      <view class="feedback-box">
        <text class="feedback-label">Feedback:</text>
        <view class="dimensions">
          <!-- Accuracy -->
          <view class="dimension-card accuracy" wx:if="{{item.data.accuracyText}}">
            <view class="dimension-header">
              <text class="dimension-title">准确性 (Accuracy)</text>
              <text class="dimension-score" wx:if="{{item.data.accuracyScore !== null}}">{{item.data.accuracyScore}}/5</text>
            </view>
            <text class="dimension-text">{{item.data.accuracyText}}</text>
          </view>

          <!-- Coherence -->
          <view class="dimension-card coherence" wx:if="{{item.data.coherenceText}}">
            <view class="dimension-header">
              <text class="dimension-title">连贯性 (Coherence)</text>
              <text class="dimension-score" wx:if="{{item.data.coherenceScore !== null}}">{{item.data.coherenceScore}}/5</text>
            </view>
            <text class="dimension-text">{{item.data.coherenceText}}</text>
          </view>

          <!-- Flexibility -->
          <view class="dimension-card flexibility" wx:if="{{item.data.flexibilityText}}">
            <view class="dimension-header">
              <text class="dimension-title">互动性 (Flexibility)</text>
              <text class="dimension-score" wx:if="{{item.data.flexibilityScore !== null}}">{{item.data.flexibilityScore}}/5</text>
            </view>
            <text class="dimension-text">{{item.data.flexibilityText}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- General Advice -->
  <view class="advice-card">
    <text class="advice-title">总体建议</text>
    <text class="advice-text">{{examResult.generalAdvice}}</text>
  </view>

  <!-- Actions -->
  <view class="action-buttons">
    <button class="btn btn-primary" bindtap="goHome">返回首页</button>
    <button class="btn btn-secondary" bindtap="viewHistory" wx:if="{{!isViewingHistory}}">查看历史</button>
  </view>
</view>



